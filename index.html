<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D FPS Aim Tester</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; cursor: crosshair; }
        #score { position: absolute; top: 10px; left: 10px; color: white; font-size: 30px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>

    <script>
        let scene = new THREE.Scene();
        let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        let renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        let score = 0;
        document.getElementById("score").innerText = `Score: ${score}`;

        // Add a blue sky background
        scene.background = new THREE.Color(0x87CEEB);

        // Add a ground plane with shadows
        let groundGeometry = new THREE.PlaneGeometry(20, 20);
        let groundMaterial = new THREE.ShadowMaterial({ opacity: 0.5 });
        let ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = Math.PI / 2;
        ground.position.y = -1.5;
        ground.receiveShadow = true;
        scene.add(ground);

        // Add a gun model and move it further up
        let gunGeometry = new THREE.BoxGeometry(0.3, 0.3, 1);
        let gunMaterial = new THREE.MeshStandardMaterial({ color: 0x222222 });
        let gun = new THREE.Mesh(gunGeometry, gunMaterial);
        gun.position.set(2, 0.5, 2); // Moved upwards
        gun.rotation.y = Math.PI / 6;
        gun.castShadow = true; // Enable shadow for gun
        scene.add(gun);

        let barrelGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.5, 32);
        let barrelMaterial = new THREE.MeshStandardMaterial({ color: 0x444444 });
        let barrel = new THREE.Mesh(barrelGeometry, barrelMaterial);
        barrel.rotation.x = Math.PI / 2;
        barrel.position.set(0, 0, -0.75);
        barrel.castShadow = true; // Enable shadow for barrel
        gun.add(barrel);

        let textureLoader = new THREE.TextureLoader();
        let customTexture = textureLoader.load("https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcTBNjk4ffW2BntjfaOTxhaPBIV5dldbaOlJRFvcfyNsEfWe8GDSTmEDd10BJzVQNxaY49ZSI-1XOs6BYf8wfXyZ6s0_43oF18GlVpT2Vb8");

        let targets = [];
        function createTarget() {
            if (targets.length >= 3) return;
            let geometry = new THREE.BoxGeometry(1.2, 1.2, 1.2); // Increased size for visibility
            let material = new THREE.MeshStandardMaterial({ map: customTexture });
            let target = new THREE.Mesh(geometry, material);
            let x = (Math.random() - 0.5) * 10;
            let y = Math.random() * 3 + 1; // Ensure targets spawn above the ground and are more visible
            let z = -5;
            target.position.set(x, y, z);
            target.castShadow = true; // Enable shadow for target
            scene.add(target);
            targets.push(target);
        }

        for (let i = 0; i < 3; i++) createTarget();

        camera.position.set(0, 1.5, 5);

        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();

        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            let intersects = raycaster.intersectObjects(targets);
            if (intersects.length > 0) {
                scene.remove(intersects[0].object);
                targets = targets.filter(t => t !== intersects[0].object);
                score++;
                document.getElementById("score").innerText = `Score: ${score}`;
                createTarget();
            }

            // Gun recoil animation (smooth recoil)
            gun.position.z -= 0.1;
            setTimeout(() => gun.position.z += 0.1, 100);
        }

        window.addEventListener('click', onMouseClick);

        // Set up the light source for shadows
        let light = new THREE.PointLight(0xFFFFFF, 1, 100);
        light.position.set(10, 10, 10);
        light.castShadow = true;
        scene.add(light);

        // Add ambient light to soften the shadows
        let ambientLight = new THREE.AmbientLight(0x404040); // Soft light
        scene.add(ambientLight);

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
